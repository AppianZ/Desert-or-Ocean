<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta id="viewport" name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="screen-orientation" content="portrait">
    <script src="https://unpkg.com/vue@2.2.2/dist/vue.js"></script>
    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        [v-cloak] {
            display: none;
        }

        body, html {
            height: 100%;
            background: #F7F8F8;
            font-family: -apple-system-font,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
        }

        #loading, #none {
            display: inline-block;
            position: absolute;
            top: 48%;
            left: 50%;
            -webkit-transform: translate3d(-50%, -50%, 0);
            -moz-transform: translate3d(-50%, -50%, 0);
            -ms-transform: translate3d(-50%, -50%, 0);
            -o-transform: translate3d(-50%, -50%, 0);
            transform: translate3d(-50%, -50%, 0);
        }

        #none {
            width: 100%;
            text-align: center;
        }

        #none img {
            display: inline-block;
            width: 60px;
            height: 60px;
            margin: 0 auto 20px auto;
        }

        #none p {
            color: #898989;
        }

        #list .item {
            position: relative;
            display: block;
            height: 50px;
            padding: 12px;
            margin: 0 0 1px 0;
            background: #fff;
        }

        .item img {
            display: inline-block;
            border-radius: 50%;
            height: 50px;
            width: 50px;
            vertical-align: top;
        }
        .item h3 {
            position: absolute;
            display: inline-block;
            width: 48%;
            top: 15px;
            left: 70px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            color: #333;
            font-size: 16px;
            font-weight: 400;
        }
        .item p {
            position: absolute;
            display: inline-block;
            width: 48%;
            top: 40px;
            left: 71px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            color: #666;
            font-size: 14px;
            font-weight: 300;
        }
        .item span {
            position: absolute;
            display: inline-block;
            top: 15px;
            right: 10px;
            width: 30%;
            color: #EB2449;
            font-size: 15px;
            font-weight: 400;
            text-align: right;
            letter-spacing: 1px;
        }
        #loadbtn p {
            text-align: center;
            height: 40px;
            line-height: 40px;
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
<div id="container" v-cloak>
    <article id="loading" v-if="apply_status">
        <svg id="svg" width='50px' height='50px' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"
             preserveAspectRatio="xMidYMid" class="uil-default">
            <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(0 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0s' repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(30 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.08333333333333333s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(60 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.16666666666666666s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(90 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.25s' repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(120 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.3333333333333333s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(150 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.4166666666666667s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(180 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.5s' repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(210 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.5833333333333334s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(240 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.6666666666666666s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(270 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.75s' repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(300 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.8333333333333334s'
                         repeatCount='indefinite'/>
            </rect>
            <rect x='46.5' y='40' width='7' height='20' rx='5' ry='5' fill='#8c8c8c'
                  transform='rotate(330 50 50) translate(0 -30)'>
                <animate attributeName='opacity' from='1' to='0' dur='1s' begin='0.9166666666666666s'
                         repeatCount='indefinite'/>
            </rect>
        </svg>
    </article>
    <article v-else>
        <section id="none" v-if="list.length === 0">
            <img src="none_icon.png"/>
            <p>小主,当前无零钱收支明细</p>
        </section>
        <section id="list" v-if="list.length !== 0">
            <div v-for="item in list" class="item">
                <img v-if="item.ext.channel" src="./channel.png">
                <img v-else-if="new RegExp('REDPACKET').test(item.ext.transferType)" src="./redpacket.png">
                <img v-else :src="item.user.iconUrl">
                <h3 v-if="item.ext.channel"
                    v-text="channelFormat(item.type, item.ext.channel)"></h3>
                <h3 v-else-if="new RegExp('REDPACKET').test(item.ext.transferType)"
                    v-text="transferTypeFormat(item.user.nickName, item.type, item.ext.transferType)"></h3>
                <h3 v-else v-text="rewardFormat(item.user.nickName, item.type, item.ext.transferType, item.amount)"></h3>
                <p v-text="dateFormat(item.createTime)"></p>
                <span v-text="(item.amount > 0 ? '+' : '') + (item.amount / 100).toFixed(2) + '元'"></span>
            </div>
            <div v-if="!last" id="loadbtn">
                <p v-if="loading_status">加载中...</p>
                <p v-else @click="addlist()">点击加载更多</p>
            </div>
        </section>
    </article>
</div>
<script>
    var V = new Vue({
        el: '#container',
        data: {
            apply_status: true,
            list: [],
            last: false,
            loading_status: false,
            response: {
                "code": "SUCCESS",
                "msg": null,
                "payload": {
                    "content": [],
                    "last": false,
                    "totalPages": 2,
                    "totalElements": 40,
                    "numberOfElements": 20,
                    "first": true,
                    "sort": null,
                    "size": 20,
                    "number": 0
                }
            } // 测试数据,可以不用管
        },
        mounted: function () {
            var _this = this;
            _this.addlist();
        },
        methods: {
            addlist: function () { // 列表请求
                var _this  = this;
                _this.loading_status = true;
                // 请求列表的ajax请求,api的使用可直接google
                $.ajax({
                     type: "GET", // 请求类型
                     url: "", // 需要请求的url
                     dataType: "json",
                     data: {
                        // 需要请求带的参数
                     },
                     beforeSend :function(xhr){
                        // 从localstorage或其他本地方式获取token
                        xhr.setRequestHeader('key名字', '值');//设置消息头
                     },
                     error: function(XHR,textStatus,errorThrown) {
                        alert ("XHR="+XHR+"\ntextStatus="+textStatus+"\nerrorThrown=" + errorThrown);
                     },
                     success: function(data) {
                         _this.list = _this.list.concat(data.payload.content);
                         _this.last = data.payload.last;
                         _this.loading_status = false;
                         _this.apply_status = false;
                     },
                 });

               /*  // 这是模拟异步请求返回后的操作
               setTimeout(function () {
                    _this.list = _this.list.concat(_this.response.payload.content);
                    _this.last = _this.response.payload.last;
                    _this.loading_status = false;
                    _this.apply_status = false;
                }, 1500);*/
            },
            channelFormat: function (type, desc) {
                var title = '';
                type === 'withdraw' ? (
                        title = `提现至${desc === 'alipay' ? '支付宝' : '微信'}`
                ) : (
                        title = `${desc === 'alipay' ? '支付宝' : '微信'}${type === 'recharge' ? '充值' : '提现失败'}`
                );
                return title;
            },
            transferTypeFormat: function (name, type, desc) {
                if (type === 'transfer') {
                    return `${name}${desc === 'REDPACKET_CREATE' ? '发出红包' : (
                            desc === 'REDPACKET_LOOT' ? '领取红包' : '未领取红包退回'
                    )}`
                } else {
                    console.log('type不为transfer');
                }
            },
            rewardFormat: function (name, type, desc, amount) {
                if (type === 'transfer' && desc === 'REWARD') {
                    return amount > 0 ? `获得${name}的动态赏金` : `我赞赏了${name}`;
                } else {
                    console.log('type不为transfer,并且ext.transferType不是REWARD');
                }
            },
            dateFormat: function (time) {
                var date = new Date(time);
                return `${date.getMonth() + 1}-${date.getDate()}
                        ${('0' + date.getHours()).substr(-2)}:${('0' + date.getMinutes()).substr(-2)}`
            },
        }
    })
</script>
</body>
</html>